<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <title>App</title>
    <script th:src="@{/webjars/jquery/3.6.0/dist/jquery.min.js}"></script>
</head>
<body>
<div>
    <H1>APP1</div>
<div>
    <button onclick="getApp1Principal()">get principal from app1</button>
</div>
<div>
    <button onclick="getApp2Principal()">get principal from app2</button>
</div>
<div>
    <button onclick="proxyToApp2()">proxy to app2</button>
</div>
<div>
    <button onclick="proxyToApp2Again()">proxy to app2 again</button>
</div>
<div>
    <a th:href="@{http://localhost:8888/app1}">go to APP1</a>
</div>
<div>
    <a th:href="@{http://localhost:9999/app2}">go to APP2</a>
</div>
<div>
    <a th:href="@{/logout}">logout</a>
</div>
</div>
<hr>
<div id="principalDiv">

</div>
<script th:inline="javascript">
    // let port = [[${port}]];

    function getApp1Principal() {
        $.ajax({
            url: 'http://localhost:8888/app1/test/principal',
            type: 'POST',
            xhrFields: {withCredentials: true},
            success: (data) => {
                console.info(data);
                $('#principalDiv').append('<p>' + JSON.stringify(data) + '</p>');
            }
        });
    }

    function getApp2Principal() {
        $.ajax({
            url: 'http://localhost:9999/app2/test/principal',
            type: 'POST',
            xhrFields: {withCredentials: true},
            success: (data) => {
                console.info(data);
                $('#principalDiv').append('<p>' + JSON.stringify(data) + '</p>');
            }
        });
    }

    function proxyToApp2() {
        // 通
        $.ajax({
            url: 'http://localhost:8888/app1/test/proxy/rex',
            type: 'POST',
            xhrFields: {withCredentials: true},
            success: (data) => {
                console.info(data);
                $('#principalDiv').append('<p>' + JSON.stringify(data) + '</p>');
            }
        });
    }

    function proxyToApp2Again() {
        // TODO 不通，加 cache 設定會通？
        $.ajax({
            url: 'http://localhost:8888/app1/test/proxy/again/RexYu',
            type: 'POST',
            xhrFields: {withCredentials: true},
            success: (data) => {
                console.info(data);
                $('#principalDiv').append('<p>' + JSON.stringify(data) + '</p>');
            }
        });
    }
</script>
</body>
</html>